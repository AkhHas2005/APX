<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Start Your Kit Order</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    td { padding: 5px; }
    label { display: block; }
    #phoneError { color: red; font-weight: bold; display: none; }
    .sales-manager-note { color: red; font-size: 0.9em; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Start Your Kit Order</h2>
  <form id="initialForm">
    <label>Name:</label>
    <input type="text" name="name" required><br>

    <label>Email:</label>
    <input type="email" name="email" required><br>

    <label>Sales Manager:</label>
    <select name="salesManager" required>
      <option value="">Choose 1</option>
      <option value="James">James</option>
      <option value="Craig">Craig</option>
    </select><br>
    <div class="sales-manager-note">
      This is your Sales rep from APX â€“ either James or Craig
    </div>

    <label>Phone Number:</label>
    <input type="text" id="phone" name="phone" required><br>
    <div id="phoneError">Please enter a valid phone number.</div><br>

    <label>Club Name:</label>
    <input type="text" name="clubName"><br><br>

    <!-- Product categories and inputs will be injected here -->
    <div id="productSelection"></div>

    <button type="submit">Continue</button>
  </form>

  <script>
    const categories = {
      Tops: [
        "Match T-Shirt", "Match Shirt (Long Sleeve)", "Goalkeeper Shirt (Long Sleeve)",
        "Training T-Shirt", "Polo Shirt", "Leisure T-Shirt",
        "Crew Neck Training Sweatshirt", "1/4 Zip Sweatshirt", "Full Zip Tracksuit Top", "Zipped Hoodie"
      ],
      Bottoms: ["Match Shorts", "Training Shorts", "Leisure Shorts", "Track Pants"],
      Accessories: ["Training Glove", "Training Socks", "Match Socks", "Player Towel", "Club Backpack"]
    };
    const oneSizeItems = ["Player Towel", "Club Backpack"];

    const productSelection = document.getElementById('productSelection');
    for (const [category, products] of Object.entries(categories)) {
      const section = document.createElement('div');
      section.innerHTML = `<h3>${category}</h3>`;
      const table = document.createElement('table');

      products.forEach(product => {
        const tr = document.createElement('tr');
        if (oneSizeItems.includes(product)) {
          tr.innerHTML = `
            <td colspan="2">
              <label>
                <input type="checkbox" name="products" value="${product}">
                ${product} (One Size)
              </label>
            </td>
          `;
        } else {
          tr.innerHTML = `
            <td>
              <label>
                <input type="checkbox" name="products" value="Junior ${product}">
                ${product} (Junior)
              </label>
            </td>
            <td>
              <label>
                <input type="checkbox" name="products" value="Adult ${product}">
                ${product} (Adult)
              </label>
            </td>
          `;
        }
        table.appendChild(tr);
      });

      section.appendChild(table);
      productSelection.appendChild(section);
    }

    document.getElementById('initialForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const phone = formData.get('phone');
      const regex = /^(?:\+44\s?7\d{3}|\(?07\d{3}\)?)\s?\d{3}\s?\d{3}$/;
      const phoneError = document.getElementById("phoneError");

      if (!regex.test(phone)) {
        phoneError.style.display = "block";
        return;
      } else {
        phoneError.style.display = "none";
      }

      const name = encodeURIComponent(formData.get('clubName'));
      const email = encodeURIComponent(formData.get('email'));
      const phoneEncoded = encodeURIComponent(phone);
      const salesManager = encodeURIComponent(formData.get('salesManager'));
      const selected = formData.getAll('products');

      if (selected.length === 0) {
        alert("Please select at least one product.");
        return;
      }

      const products = selected.map(p => encodeURIComponent(p)).join(',');
      const redirectUrl = `./sizes.html?name=${name}&email=${email}&phone=${phoneEncoded}&salesManager=${salesManager}&products=${products}`;
      window.location.href = redirectUrl;
    });
  </script>
</body>
</html>
